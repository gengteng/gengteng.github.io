<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gteng.org","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="一口笔记">
<meta property="og:url" content="https://gteng.org/page/2/index.html">
<meta property="og:site_name" content="一口笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Thomasg">
<meta property="article:tag" content="Rust,Java">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://gteng.org/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>一口笔记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">一口笔记</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">常期望安定，还期望即兴。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2022/08/13/sync-async-blocking-nonblocking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/13/sync-async-blocking-nonblocking/" class="post-title-link" itemprop="url">同步与异步，阻塞与非阻塞</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-13 19:26:55" itemprop="dateCreated datePublished" datetime="2022-08-13T19:26:55+08:00">2022-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>想写这样一篇总结也是因为在互联网上看了太多乱七八糟的说法，往往让读者越看越糊涂。这些说法往往给我这样的感觉：</p>
<ol>
<li><strong>没有先讲清楚在形容什么</strong>：同步、异步、阻塞、非阻塞通常作为形容词使用，无论是用在日常语境，还是用在编程领域内部，如果你不知道这些形容词是放在什么名词之前就开始讲什么意思，甚至一段话中掺杂多个名词去形容而不说明，那就会给人不知所云的感觉。</li>
<li><strong>概念与实现混为一谈</strong>：同步阻塞、异步非阻塞是非常常见的组合方式，所以在讲同步、异步的概念时，它们忍不住拿这些具体实现来讲概念，也就顶多能让读者理解这些固定搭配，难以活学活用（其实能不能做到前者都存疑，甚至作者自己真的懂吗？）。</li>
<li><strong>不恰当的比喻</strong>：比喻的使用是为了帮助表达，本体和喻体之间当然是不同的事物（否则就不是比喻了），但是讲了个生动的比喻，却没有把本体与喻体之间的对应关系讲清楚，或者没有讲清楚这个比喻的边界，给话题引入了不必要的复杂性，起到了相反的作用。</li>
</ol>
<p>所以，我打算好好聊一下我对这个话题的理解，尽可能不要犯我认为别人犯过的这些错误，欢迎读者监督。</p>
<h2 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h2><p>同步这个词在日常语境下与计算机是有着一些不同的。日常语境下，同步经常用在同时进行的事情上，比如“多个平台同步直播卖货”，“推动新时代四化同步发展”，当然它们之间是经过协调一致的，不是无组织无纪律各行其是的。</p>
<p>而在编程领域，“同步”和“异步”通常用来是形容“任务”、“函数”等可执行对象的（以下统一称作“任务”）；当然也有用来形容“API”的，此时它们表示的是一种具体实现的风格，即“同步风格的API”、“异步风格的API”，它跟前者有关系也有区别。</p>
<p>那它们究竟是什么意思呢？</p>
<p>无论是同步还是异步，都一定是用来形容<strong>多个任务</strong>的，我们可以说这两个任务或者这三个函数是同步或者异步执行的，但是一个任务不存在同步或者异步。<strong>同步指的是多个任务一个一个执行，不存在时间重叠的情况，异步指的是多个任务不一个一个执行，可能存在时间重叠的情况。</strong></p>
<blockquote>
<p>有的说法硬要在讲清楚这个概念之前，先把这个任务假设成一个异步函数，再把它分成调用和获取结果两个步骤，开始谈什么消息，打比方讲什么先打了个电话订餐，又接了个电话通知，然后告诉你这叫异步，这是很容易造成误解的。即便要拆成俩，单个任务的调用和获取结果也一定是一前一后，不可能先获取结果再调用，也不可能同时进行，这两个步骤是同步的，不以具体实现为转移，它们只是可能跟另一个任务是异步的，拆成俩徒增复杂度，没有任何必要。所以干脆不要拆，也不要聊具体实现，我们说一个任务，它就是一个任务，就是执行一段时间拿到结果，不要拆开。比如“吃外卖”，就等于“下单-收到电话-取餐-吃”这整个过程，反正经过了一段时间，<strong>不要在意内部细节</strong>。</p>
</blockquote>
<p>那么，同步和异步应该怎么使用呢，比如；</p>
<ol>
<li>我先吃了个外卖，然后打了一会游戏，吃外卖和打游戏这两个任务就是同步的。</li>
<li>我先吃了个外卖，然后打了一会游戏，又写了会代码，这三个任务也是同步的。</li>
<li>在 2. 的基础上，我在吃外卖的过程中还听了一段时间的音乐，那么听音乐和吃外卖是异步的（不要管我什么时候开的音乐，什么时候关的音乐）。</li>
<li>在 2. 的基础上，打游戏期间都是保证把音乐关掉了的，但是吃外卖和写代码期间都听了一会音乐，那么听音乐和玩游戏是同步的，和吃外卖、写代码是异步的。</li>
</ol>
<p>是不是很简单，只要按照那个定义去套就行了。但是有一点要注意，4. 里面的 “打游戏期间都是保证把音乐关掉了” 的 “保证” 二字是很关键的，它确保了听音乐和玩游戏之间的 “一个一个执行” 的条件，这需要我在玩游戏之前确保音乐是关掉的，又保证玩游戏期间没有突然去把音乐打开，如果你只是凭运气，只是偶然造成了 “玩游戏期间音乐是关掉的” 的结果，那么它仍然是异步的，因为异步的定义里说的是“可能存在时间重叠”，你没有确保完全排除这个可能，它们就是异步的。</p>
<p>我们再回到日常语境下的“同步”，会发现它跟编程的“同步”是相通的。比如“多个平台同步直播卖货”，虽然整体上各平台是同时在直播一个流媒体源，看上去更符合异步的定义，但其实把“直播”拆分成“录制”、“拉流”、“转场”、“互动”、“上链接”等任务时，会发现它们之间还是存在一些比较严格的先后顺序的，比如你不可能在媒体源录制之前拉流，也不可能在某个重要互动之前就享受某些优惠。也就是说，日常语境下的同步，更多的是描述两件相关的大任务，它们的子任务只要存在一定程度的“保证”就可以说“同步”，并没有编程领域这么严格。</p>
<h2 id="阻塞与非阻塞"><a href="#阻塞与非阻塞" class="headerlink" title="阻塞与非阻塞"></a>阻塞与非阻塞</h2><p>这确实是一对很难脱离具体实现讲的概念。</p>
<p>不过相比同步与异步，阻塞与非阻塞更简单，是用来形容单个可执行对象（以下仍统一称作“任务”）的执行状态的。</p>
<p>可能被形容的有线程、协程、某一段业务逻辑等等：</p>
<ol>
<li>我在某线程用 BIO 接口读一个文件，造成该线程无法继续运行，这就是线程阻塞了</li>
<li>我在某协程内使用该语言/框架提供的 sleep 方法，造成协程无法继续运行，这就是协程阻塞了（所在线程并没有阻塞）</li>
<li>我写了一段代码，反正调用 IO 或者 sleep 了，我也不知道运行在哪个线程上，哪个协程上，或者只是一个异步的 setTimeout， 反正就是在等，这就是业务逻辑阻塞了（可能线程和协程都没有被阻塞）</li>
</ol>
<p>但其实这样说有点扩大概念外延的意思，99.9% 的情况下，我们说阻塞指的都是线程。而非阻塞，通常指的也是某个任务不会造成线程阻塞。</p>
<p>为什么线程阻塞是最常讨论的话题呢？因为：</p>
<ol>
<li><strong>线程的调度和空间占用，都是比较消耗系统资源的。</strong>一个 I/O 密集型业务（比如最常见的 Web 服务），如果会因为 I/O 阻塞线程，那么为了支持多个并发同时进行，就需要为每个独立的并发单独开一个线程。在并发较高时，就需要开大量的线程，占用大量 CPU 和内存资源，所以我们有了 C10K 问题。</li>
<li><strong>这是一个已经被用各种方式花式解决了的问题了。</strong>Linux 上的 epoll、Windows 上的 IOCP、MacOS 上的 kqueue（先不要管它们是异步/同步、阻塞/非阻塞，总之 —&gt;），都提供了可以让调用者不必开一堆线程而只需要复用固定数量的线程即可支撑较高并发的接口。不管是 Nodejs，还是 Vert.X 的异步回调，Go 的有栈协程，Rust 的无栈协程，甭管它们封装成异步风格还是同步风格的API，是甜还是咸，都是建立在前者基础上的。简单说，目的只有一个：<strong>不阻塞调用者的线程，或者说线程复用</strong>。</li>
</ol>
<p>业务要你等3秒，网络数据包要等几百毫秒才能到，硬盘读写要有时间，这些都会造成业务逻辑的阻塞，如果使用 BIO 接口，则业务逻辑的阻塞也会导致线程的阻塞。而使用了上述的框架/语言，让你不用在这些时候阻塞自己的线程，被阻塞的就只有当前业务逻辑，线程可以去跑别的业务逻辑，实现了线程复用。</p>
<h2 id="组合起来"><a href="#组合起来" class="headerlink" title="组合起来"></a>组合起来</h2><p>现在，单讲同步、异步、阻塞、非阻塞，应该没什么问题了，我们再聊聊那些常见的搭配。</p>
<p>我们经常听说同步阻塞、异步非阻塞这种搭配方式，而如果按照前文的定义，这种搭配方式是很奇怪的——同步和异步是用来形容多个任务的，阻塞和非阻塞时是说单个任务的，这样组合在一起是在干嘛？</p>
<p>一般来讲，它们是用来形容某种 API 的风格和实现的。</p>
<p><strong>同步和异步是表示这种 API 的接口风格。</strong>比如常见的 Linux 的 BIO 接口、Go 的 IO 接口、Rust 里的 async 函数，这些都是<strong>同步风格</strong>的接口，<strong>先后调用这样的两个接口，它们默认是同步执行的</strong>，你要异步执行，需要另外开线程或者协程；Node.js、Vert.X  的绝大部分接口，都是<strong>异步风格</strong>的接口，<strong>先后调用这样的两个接口，它们默认是异步执行的</strong>，你要同步执行，需要把第二个接口写到前一个接口的回调函数里。</p>
<p><strong>阻塞和非阻塞是表示这种 API 需要调用者配合使用的线程模型。</strong>比如 Linux 的 BIO 接口会阻塞调用者的线程，它就是阻塞的，而 Go 的 IO 接口、Rust 的 async 函数、Node.js 和 Vert.X 里的异步接口，都不会阻塞调用者的线程，它们就是非阻塞的。</p>
<p>在没有协程的年代，同步风格的 BIO 接口就是会导致线程阻塞，它意味着心智负担小，开发方便，但是吃资源；而不会阻塞线程的 NIO/AIO 接口往往是异步风格（或者封装为异步风格），代码写起来心智负担重，性能好，比如 Node.js 和 Vert.X。所以经常有人拿同步代指阻塞，拿异步代指非阻塞，它们成为了同义词两两绑定在一起，即“同步阻塞”和“异步非阻塞”。</p>
<p>而 Go 、Rust 等语言提供的协程，相当于是对“异步非阻塞”的一种高级封装，可以像写同步代码那样写不阻塞线程的代码，让你即拥有高性能，又没有很高的心智负担。但是也很少见他们讨论自己是同步还是异步，阻塞还是非阻塞，因为风格上确实是同步的，封装的实际上是异步常用的非阻塞接口，确实不会阻塞线程，但是协程是可能被阻塞。<strong>所以不要套概念，理解原理，理解同步具体指的是谁和谁，异步具体指的是谁和谁，阻塞和非阻塞指的具体是谁，搞清楚对象，套定义就可以了。</strong></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在写这篇文章的时候，我并没有查询很多资料，但自认为这算是一个可以简化问题，帮助理解的模型。</p>
<p>希望能给读者一些启发，也欢迎批评指正。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/10/08/heap-sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/08/heap-sort/" class="post-title-link" itemprop="url">堆排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-08 15:38:13" itemprop="dateCreated datePublished" datetime="2021-10-08T15:38:13+08:00">2021-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用数组结构表示堆结构，元素从索引 0 开始，则索引 <code>i</code> 位置：</p>
<ul>
<li>父节点索引为 $(i - 1) / 2$</li>
<li>左孩子索引为 $2 \times i + 1$</li>
<li>右孩子索引为 $2 \times i + 2$</li>
</ul>
<hr>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Heap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Heap heap = <span class="keyword">new</span> Heap(<span class="number">1000</span>);</span><br><span class="line">        heap.push(-<span class="number">6</span>);</span><br><span class="line">        heap.push(<span class="number">3</span>);</span><br><span class="line">        heap.push(-<span class="number">1</span>);</span><br><span class="line">        heap.push(<span class="number">0</span>);</span><br><span class="line">        heap.push(<span class="number">9</span>);</span><br><span class="line">        heap.push(-<span class="number">4</span>);</span><br><span class="line">        heap.push(<span class="number">5</span>);</span><br><span class="line">        heap.push(<span class="number">7</span>);</span><br><span class="line">        heap.push(-<span class="number">2</span>);</span><br><span class="line">        heap.push(<span class="number">9</span>);</span><br><span class="line">        heap.push(<span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(heap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!heap.isEmpty()) &#123;</span><br><span class="line">            System.out.println(heap.pop());</span><br><span class="line">            System.out.println(heap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> heapSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Heap</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.limit = limit;</span><br><span class="line">        <span class="keyword">this</span>.data = <span class="keyword">new</span> <span class="keyword">int</span>[limit];</span><br><span class="line">        <span class="keyword">this</span>.heapSize = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (heapSize &gt;= limit) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;heapSize must not exceed limit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.data[heapSize++] = value;</span><br><span class="line">        heapInsert(heapSize - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> heapSize == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        swap(--heapSize, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> result = <span class="keyword">this</span>.data[heapSize];</span><br><span class="line">        <span class="keyword">this</span>.data[heapSize] = <span class="number">0</span>;</span><br><span class="line">        heapify(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">heapInsert</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (index &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.data[index] &gt; <span class="keyword">this</span>.data[(index - <span class="number">1</span>) / <span class="number">2</span>]) &#123;</span><br><span class="line">            swap(index, (index - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">            index = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i != j) &#123;</span><br><span class="line">            <span class="keyword">this</span>.data[i] = <span class="keyword">this</span>.data[i] ^ <span class="keyword">this</span>.data[j];</span><br><span class="line">            <span class="keyword">this</span>.data[j] = <span class="keyword">this</span>.data[i] ^ <span class="keyword">this</span>.data[j];</span><br><span class="line">            <span class="keyword">this</span>.data[i] = <span class="keyword">this</span>.data[i] ^ <span class="keyword">this</span>.data[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">heapify</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> leftIndex = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (leftIndex &lt; heapSize) &#123;</span><br><span class="line">            <span class="keyword">int</span> rightIndex = leftIndex + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> greatestIndex = rightIndex &lt; heapSize &amp;&amp; <span class="keyword">this</span>.data[rightIndex] &gt; <span class="keyword">this</span>.data[leftIndex] ? rightIndex : leftIndex;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.data[greatestIndex] &lt;= <span class="keyword">this</span>.data[index]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            swap(index, greatestIndex);</span><br><span class="line">            index = greatestIndex;</span><br><span class="line">            leftIndex = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder b = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        b.append(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;heapSize; i++) &#123;</span><br><span class="line">            b.append(data[i]);</span><br><span class="line">            <span class="keyword">if</span> (i != heapSize - <span class="number">1</span>)</span><br><span class="line">                b.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        b.append(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> b.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[13, 9, 5, 3, 9, -4, -1, -6, -2, 0, 7]</span><br><span class="line">13</span><br><span class="line">[9, 9, 5, 3, 7, -4, -1, -6, -2, 0]</span><br><span class="line">9</span><br><span class="line">[9, 7, 5, 3, 0, -4, -1, -6, -2]</span><br><span class="line">9</span><br><span class="line">[7, 3, 5, -2, 0, -4, -1, -6]</span><br><span class="line">7</span><br><span class="line">[5, 3, -1, -2, 0, -4, -6]</span><br><span class="line">5</span><br><span class="line">[3, 0, -1, -2, -6, -4]</span><br><span class="line">3</span><br><span class="line">[0, -2, -1, -4, -6]</span><br><span class="line">0</span><br><span class="line">[-1, -2, -6, -4]</span><br><span class="line">-1</span><br><span class="line">[-2, -4, -6]</span><br><span class="line">-2</span><br><span class="line">[-4, -6]</span><br><span class="line">-4</span><br><span class="line">[-6]</span><br><span class="line">-6</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Heap</span></span>&lt;T&gt;(<span class="built_in">Vec</span>&lt;T&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span>&gt; Heap&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span>(<span class="built_in">Vec</span>::new())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">push</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span>.push(value);</span><br><span class="line">        <span class="keyword">self</span>.heap_insert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">pop</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="number">0</span>.is_empty() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> last = <span class="keyword">self</span>.<span class="number">0</span>.len() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span>.swap(<span class="number">0</span>, last);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">self</span>.<span class="number">0</span>.pop();</span><br><span class="line">        <span class="keyword">self</span>.heapify();</span><br><span class="line">        result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">heapify</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.<span class="number">0</span>.len();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> left = index * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt; len &#123;</span><br><span class="line">            <span class="keyword">let</span> right = left + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">let</span> greatest = <span class="keyword">if</span> right &lt; len &amp;&amp; <span class="keyword">self</span>.<span class="number">0</span>[left] &lt; <span class="keyword">self</span>.<span class="number">0</span>[right] &#123;</span><br><span class="line">                right</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.<span class="number">0</span>[greatest] &lt;= <span class="keyword">self</span>.<span class="number">0</span>[index] &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.<span class="number">0</span>.swap(index, greatest);</span><br><span class="line">            index = greatest;</span><br><span class="line">            left = index * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">heap_insert</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.<span class="number">0</span>.is_empty() &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> index = <span class="keyword">self</span>.<span class="number">0</span>.len() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> parent = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">self</span>.<span class="number">0</span>[parent] &lt; <span class="keyword">self</span>.<span class="number">0</span>[index] &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="number">0</span>.swap(index, parent);</span><br><span class="line">            index = parent;</span><br><span class="line">            <span class="keyword">if</span> index == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            parent = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span>&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> Heap&lt;T&gt; &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Item</span></span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.pop()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_heap</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">1000</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> array: [<span class="built_in">u8</span>; <span class="number">32</span>] = rand::random();</span><br><span class="line">        <span class="keyword">let</span> sorted = &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> s = array.clone();</span><br><span class="line">            s.sort_by(|a, b| b.cmp(a));</span><br><span class="line">            s</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> heap = Heap::new();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> array &#123;</span><br><span class="line">            heap.push(a);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> heap_sorted: <span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt; = heap.collect();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(heap_sorted, sorted);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/26/redis-practices/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/26/redis-practices/" class="post-title-link" itemprop="url">Redis 学习笔记（实践）[WIP]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-26 11:22:51" itemprop="dateCreated datePublished" datetime="2021-09-26T11:22:51+08:00">2021-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-降低-String-内存开销"><a href="#1-降低-String-内存开销" class="headerlink" title="1. 降低 String 内存开销"></a>1. 降低 String 内存开销</h2><hr>
<h2 id="2-统计"><a href="#2-统计" class="headerlink" title="2. 统计"></a>2. 统计</h2><hr>
<h2 id="3-GEO"><a href="#3-GEO" class="headerlink" title="3. GEO"></a>3. GEO</h2><hr>
<h2 id="4-时间序列数据"><a href="#4-时间序列数据" class="headerlink" title="4. 时间序列数据"></a>4. 时间序列数据</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/23/redis-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/23/redis-basics/" class="post-title-link" itemprop="url">Redis 学习笔记（基础）[WIP]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-23 19:18:46" itemprop="dateCreated datePublished" datetime="2021-09-23T19:18:46+08:00">2021-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-基本架构"><a href="#1-基本架构" class="headerlink" title="1. 基本架构"></a>1. 基本架构</h2><p>一个键值数据库需要有哪些功能/结构/特性。</p>
<ul>
<li>支持多种数据结构</li>
<li>PUT、GET、DELETE、SCAN</li>
<li>设置过期</li>
<li>索引结构</li>
<li>对外接口，Socket、动态链接库等等</li>
<li>存储方式，内存、硬盘（持久化）</li>
<li>高可用</li>
<li>横向扩展</li>
<li>功能可扩展性</li>
</ul>
<hr>
<h2 id="2-数据结构"><a href="#2-数据结构" class="headerlink" title="2. 数据结构"></a>2. 数据结构</h2><p>Redis 接收到一个键值对操作后，能以 <strong>微秒</strong> 级别的速度找到数据，并快速完成操作。</p>
<p>Redis 的值有如下数据类型：</p>
<ul>
<li>String（字符串）</li>
<li>List（列表）</li>
<li>Hash（哈希）</li>
<li>Set（集合）</li>
<li>Sorted Set（有序集合）</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>数据结构</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>简单动态字符串</td>
</tr>
<tr>
<td>List</td>
<td>双向链表/压缩列表</td>
</tr>
<tr>
<td>Hash</td>
<td>压缩列表/哈希表</td>
</tr>
<tr>
<td>Set</td>
<td>整数数组/哈希表</td>
</tr>
<tr>
<td>Sorted Set</td>
<td>压缩列表/跳表</td>
</tr>
</tbody>
</table>
</div>
<p>Redis 使用一个全局的哈希表来保存所有键值对，可以在 $O(1)$ 的时间内查找到键值对。</p>
<p>一个哈希表就是一个数组，数组元素为哈希桶，每个哈希桶存放一个链表，连接着哈希值映射到该桶中的多个键值对。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">｜0｜1｜2｜3｜4｜5｜</span><br><span class="line">    |       |</span><br><span class="line">    |       ---&gt; entry4</span><br><span class="line">    |</span><br><span class="line">    ---&gt; entry1 ---&gt; entry2 ---&gt; entry3</span><br></pre></td></tr></table></figure>
<h3 id="哈希冲突及rehash"><a href="#哈希冲突及rehash" class="headerlink" title="哈希冲突及rehash"></a>哈希冲突及rehash</h3><p>当哈希冲突过多时，链表过长，导致查找效率下降，Redis会对哈希表进行rehash。</p>
<p>为了 <strong>使 rehash 更高效</strong>，Redis 使用了两个全局哈希表：哈希表 1 和 哈希表 2 。默认情况下使用哈希表 1 ，哈希表 2 没有分配空间，当键值对增多时，Redis开始进行rehash：</p>
<ol>
<li>给哈希表 2 分配更大的空间，例如是当前哈希表 1 大小的两倍；</li>
<li>把哈希表 1 中的数据重新映射并拷贝到哈希表 2 中；</li>
<li>释放哈希表 1 的空间。</li>
</ol>
<p>然后使用哈希表 2 保存数据，下次rehash再使用哈希表 1 。</p>
<p>为 <strong>避免一次性拷贝大量数据造成 Redis 线程阻塞</strong>，Redis采用了渐进式rehash。</p>
<h4 id="渐进式rehash"><a href="#渐进式rehash" class="headerlink" title="渐进式rehash"></a>渐进式rehash</h4><p>Redis可以保持处理用户请求，每处理一个请求，就顺带将哈希表 1 中的一个桶的所有entries拷贝到哈希表 2 中。这样就能把一次性大量拷贝的开销，分摊到了多次请求中，避免了耗时可能造成的阻塞。</p>
<h3 id="数据结构的操作效率"><a href="#数据结构的操作效率" class="headerlink" title="数据结构的操作效率"></a>数据结构的操作效率</h3><p><strong>整数数组</strong> 和 <strong>双向链表</strong> 都是顺序读写，操作复杂度都是 $O(N)$。</p>
<h4 id="压缩列表"><a href="#压缩列表" class="headerlink" title="压缩列表"></a>压缩列表</h4><p>压缩列表表头有 <strong>列表长度（zlbytes）</strong>、<strong>列表尾偏移量（zltail）</strong>、<strong>列表中entry个数（zllen）</strong> 三个字段，表尾有一个 <strong>zlend</strong> 字段表示 <strong>列表结束</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| zlbytes | zltail | zllen | entry1 | entry2 | ... | entryN | zlend |</span><br></pre></td></tr></table></figure>
<p>查找表头、表尾元素的复杂度为 $O(1)$，查找其他元素的复杂度为 $O(N)$。</p>
<h4 id="跳表"><a href="#跳表" class="headerlink" title="跳表"></a>跳表</h4><p><strong>跳表</strong> 是在 <strong>有序链表</strong> 的基础上增加了多级索引，通过索引位置的几次跳转，实现数据快速定位。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 ----------------------&gt; 27 -----------------------&gt; 100 &#x2F;&#x2F; 二级索引</span><br><span class="line">↓                         ↓                           ↓</span><br><span class="line">1 --------&gt; 11 ---------&gt; 27 ---------&gt; 50 ---------&gt; 100 &#x2F;&#x2F; 一级索引</span><br><span class="line">↓           ↓             ↓             ↓             ↓</span><br><span class="line">1 --&gt; 5 --&gt; 11 --&gt; 20 --&gt; 27 --&gt; 33 --&gt; 50 --&gt; 62 --&gt; 100 --&gt; 156 &#x2F;&#x2F; 链表</span><br></pre></td></tr></table></figure>
<p><strong>跳表</strong> 的查找复杂度为 $O(logN)$。</p>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><h4 id="数据结构的时间复杂度"><a href="#数据结构的时间复杂度" class="headerlink" title="数据结构的时间复杂度"></a>数据结构的时间复杂度</h4><div class="table-container">
<table>
<thead>
<tr>
<th>数据结构</th>
<th>时间复杂度</th>
</tr>
</thead>
<tbody>
<tr>
<td>哈希表</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>跳表</td>
<td>$O(logN)$</td>
</tr>
<tr>
<td>双向链表</td>
<td>$O(N)$</td>
</tr>
<tr>
<td>压缩列表</td>
<td>$O(N)$</td>
</tr>
<tr>
<td>整数数组</td>
<td>$O(N)$</td>
</tr>
</tbody>
</table>
</div>
<h4 id="不同操作的时间复杂度"><a href="#不同操作的时间复杂度" class="headerlink" title="不同操作的时间复杂度"></a>不同操作的时间复杂度</h4><ol>
<li><strong>单元数操作是基础</strong>。每一种集合类型对单个数据实现的增删改查操作，复杂度由数据结构决定。</li>
<li><strong>范围操作很耗时</strong>。返回一个范围内的数据，复杂度一般是 $O(N)$，应尽量避免，可以使用 2.8 版本之后的 <code>HSCAN</code>、<code>SSCAN</code>、<code>ZSCAN</code> 等命令进行渐进式遍历。</li>
<li><strong>统计操作通常高效</strong>。集合类型对集合中的元素个数由记录，例如 <code>LLEN</code>、<code>SCARD</code>。</li>
<li><strong>例外情况只有几个</strong>。压缩列表和双向列表的会记录表头和表尾的偏移量，对它们的操作复杂度只有 $O(1)$，例如 <code>LPOP</code>、<code>RPOP</code>、<code>LPUSH</code>、<code>RPUSH</code>。</li>
</ol>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>整数数组和压缩列表在查找时间复杂度方面并没有很大优势，为什么Redis还会把它作为底层数据结构？</p>
<p>主要有两方面原因：</p>
<ol>
<li>内存利用率。Redis 是内存数据库，大量数据存储在内存中，整数数组和压缩列表结构比较紧凑，相比链表结构占用内存更少，可以提高内存利用率。</li>
<li>数组对CPU高速缓存支持更友好。集合元素较少时，使用内存紧凑的排列方式，可以利用CPU高速缓存，尤其在一个缓存行内（64字节）有更高效的访问效率。当元素数量超过阈值后，为避免复杂度太高，可以转为哈希表和跳表。</li>
</ol>
<h2 id="3-高性能-IO-模型"><a href="#3-高性能-IO-模型" class="headerlink" title="3. 高性能 IO 模型"></a>3. 高性能 IO 模型</h2><p>Redis 的网络 IO 和键值对读写是由单个线程完成的；其他功能，例如持久化、异步删除、集群数据同步，是由额外的线程执行的。</p>
<p>Redis使用 <strong>IO多路复用</strong>，即一个线程处理多个 IO 流。</p>
<p>可能存在的瓶颈（来自Kaito）：</p>
<ol>
<li>单个请求耗时会导致后续所有请求阻塞等待，包括以下几种：<ul>
<li>操作bigkey，分配、释放内存（4.0推出了lazy-free，可以异步执行bigkey释放）</li>
<li>使用复杂度较高的命令，排序、union、查询全量数据</li>
<li>大量key集中过期</li>
<li>淘汰策略，内存超过Redis内存上线，每次写入都要淘汰一些key，导致耗时变长</li>
<li>AOF 开启 always</li>
<li>主从同步生成 RDB 时的 fork</li>
</ul>
</li>
<li>并发量大时，单线程处理客户端请求，无法利用多核（6.0推出了多线程，可利用多核CPU处理用户请求）</li>
</ol>
<hr>
<h2 id="4-AOF（Append-Only-File）"><a href="#4-AOF（Append-Only-File）" class="headerlink" title="4. AOF（Append Only File）"></a>4. AOF（Append Only File）</h2><p>Redis 的 AOF 是写后日志，先执行命令，把数据写入内存，然后再记录日志。</p>
<p>不会阻塞当前写操作，执行完命令还没来得及记日志就宕机的话，会有数据丢失的风险。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*3 --&gt; 这个命令有三个部分</span><br><span class="line">$3 --&gt; 第一部分的长度</span><br><span class="line">set --&gt; 第一部分的内容</span><br><span class="line">$5</span><br><span class="line">hello</span><br><span class="line">$5</span><br><span class="line">world</span><br></pre></td></tr></table></figure>
<h3 id="三种写回策略"><a href="#三种写回策略" class="headerlink" title="三种写回策略"></a>三种写回策略</h3><ul>
<li>Always，同步写回，每个命令执行完立马写回磁盘</li>
<li>EverySec，每秒写回，写到AOF内存缓存，每秒写回一次</li>
<li>No，写到AOF内存缓存，由操作系统决定何时将其写回</li>
</ul>
<h3 id="日志重写"><a href="#日志重写" class="headerlink" title="日志重写"></a>日志重写</h3><p>当日志文件过大时，可以对日志进行重写。可以把某些多条修改同一个键值对的命令合并为一条。</p>
<p>重写流程：</p>
<ol>
<li>主线程 fork 出 bgrewriteaof 子进程，主线程在将新指令写入 AOF 缓存时，还会写入 AOF 重写缓存；</li>
<li>子进程将 fork 拷贝出来的内存快照写成命令日志；</li>
<li>写完后将AOF重写缓存中的日志写到这个新的日志中，然后就可以用这个新日志替换旧日志了。</li>
</ol>
<h3 id="其他要点"><a href="#其他要点" class="headerlink" title="其他要点"></a>其他要点</h3><ol>
<li>fork 使用的是操作系统的写时复制（Copy On Write）机制，并不会直接拷贝所有内存。但是会拷贝父进程的的内存页表，如果页表较大，可能导致阻塞。</li>
<li>主进程在提供服务时，如果操作的是bigkey，写时复制会导致内存分配；如果开启了内存大页（huge page）机制，内存分配会产生阻塞。（所以使用Redis通常要关闭内存大页，其对使用 fork 的程序不友好）</li>
<li>AOF 重写可以使用 <code>bgrewriteaof</code> 命令手动执行，也由两个配置项控制自动触发：<ul>
<li>auto-aof-rewrite-min-size：表示运行AOF重写的最小大小，默认为 64MB；</li>
<li>auto-aof-rewrite-percentage：当前AOF文件大小和上一次重写后AOF文件大小的差值，除以上一次重写AOF文件大小，即增量和上一次全量的比值，默认为 100。<br>AOF 文件大小同时满足这两个配置项，会自动触发 AOF 重写。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="5-内存快照-RDB"><a href="#5-内存快照-RDB" class="headerlink" title="5. 内存快照 RDB"></a>5. 内存快照 RDB</h2><p>把某一时刻的内存数据以文件的形式写到磁盘上，即快照。这个快照文件即 RDB 文件（Redis DataBase 的缩写）。</p>
<p>在数据恢复时，可直接把 RDB 文件读入内存，很快完成恢复。</p>
<p>Redis 执行的是全量快照。</p>
<p>可以使用 <code>save</code>、<code>bgsave</code> 来生成 RDB 文件；save在主线程中执行，会阻塞；bgsave 会创建子进程专门进行 RDB 文件写入，不会阻塞。</p>
<h3 id="快照进行时数据如何修改"><a href="#快照进行时数据如何修改" class="headerlink" title="快照进行时数据如何修改"></a>快照进行时数据如何修改</h3><p>使用 fork 创建子进程，该子进程会跟主线程共享所有内存数据；利用操作系统的写时复制技术，当主进程修改数据时，会重新分配空间生成该数据的副本，并使用该副本提供服务，bgsave 子进程仍然使用未修改的数据进行快照写入。</p>
<h3 id="快照频率"><a href="#快照频率" class="headerlink" title="快照频率"></a>快照频率</h3><p>频繁执行全量快照有两方面开销：</p>
<ol>
<li>给磁盘带来压力</li>
<li>fork 本身可能阻塞主线程，如果频繁 fork 会导致主线程阻塞所以，如果有一个 bgsave 在运行，就不会启动第二个了</li>
</ol>
<p>4.0 中提出了混合使用AOF和RDB的方法，即快照以一定的频率执行，在快照间以AOF的形式记录这期间的命令。实现：</p>
<ol>
<li>避免了频繁 fork 对主线程的影响</li>
<li>减少了 AOF 文件大小，提高了数据恢复效率</li>
</ol>
<p>在配置文件中设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>
<h3 id="三点建议"><a href="#三点建议" class="headerlink" title="三点建议"></a>三点建议</h3><ol>
<li>数据不能丢失时，使用 AOF 和 RDB 混合方案</li>
<li>允许分钟级别的数据丢失，使用 RDB</li>
<li>只用 AOF 的话，优先使用 everysec，在可靠性和性能之间比较平衡</li>
</ol>
<p>课后题：资源风险（Kaito）</p>
<ol>
<li>考虑 fork 导致多大程度的写时复制，是否会造成 OOM，或者 swap 到磁盘上导致性能降低；</li>
<li>CPU 核数较少时，Redis的其他子进程会跟主线程竞争CPU，导致性能下降；</li>
<li>如果 Redis 进程绑定了 CPU，子进程会继承它的 CPU 亲和属性，与父进程争夺同一个 CPU 资源，导致效率下降。所以如果开启RDB和AOF，一定不要绑定CPU。</li>
</ol>
<hr>
<h2 id="6-主从同步"><a href="#6-主从同步" class="headerlink" title="6. 主从同步"></a>6. 主从同步</h2><p>可靠性分两方面：</p>
<ol>
<li><strong>数据少丢失</strong>（由RDB、AOF保证）；</li>
<li><strong>服务少中断</strong>（通过增加副本冗余量保证）</li>
</ol>
<p><strong>读写分离</strong>：主库、从库都可以执行读操作，主库限制性写操作，然后同步给从库。</p>
<p>如果都允许写，会造成各实例副本不一致，需要涉及加锁、协商等各种操作，产生巨额开销。</p>
<h3 id="主从第一次同步"><a href="#主从第一次同步" class="headerlink" title="主从第一次同步"></a>主从第一次同步</h3><p>在从库实例上执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof [主库ip] [主库port]</span><br></pre></td></tr></table></figure>
<h4 id="三个阶段"><a href="#三个阶段" class="headerlink" title="三个阶段"></a>三个阶段</h4><ol>
<li>主从建立链接、协商同步，从库给主库发送 psync 命令，表示要进行数据同步，主库根据这个命令的参数来启动复制。psync 命令包含了主库的 runID 和复制进度 offset 两个参数。主库收到 psync 命令后，用 <code>FULLRESYNC</code> 响应命令带上两个参数，主库的 runID 和主库目前的复制进度 offset 给从库，从库会记住这两个参数。</li>
</ol>
<blockquote>
<p>runID：每个 Redis 实例启动时自动生成的一个随机 ID，唯一标识一个实例。第一次复制时从库不知道主库的 runID，使用 <code>?</code>；<br>offset：第一次复制设置为 <code>-1</code>。</p>
</blockquote>
<ol>
<li>主库执行 bgsave 生成 RDB 文件，并发送给从库。从库收到 RDB 文件后，清空数据库并加载 RDB 文件。此时主库不会停止服务，但在内存中会有专门的 replication buffer，记录 RDB 文件生成后收到的所有写操作。</li>
<li>主库把 replication buffer 中的修改操作发送给从库执行。</li>
</ol>
<h4 id="主从级联"><a href="#主从级联" class="headerlink" title="主从级联"></a>主从级联</h4><p>使用“主-从-从”模式分担主库压力。二级从库可以选择一个内存较高的从库进行同步。</p>
<p>主从间使用基于长连接的命令传播。</p>
<h4 id="网络断开"><a href="#网络断开" class="headerlink" title="网络断开"></a>网络断开</h4><p>2.8 前网络闪断会造成重新全量复制，2.8 后可以增量复制，实现继续同步。</p>
<p>（Kaito）主库除了将所有写命令传给从库之外，也会在 <code>repl_backlog_buffer</code> 中记录一份。当从库断线重连后，会发送 <code>psync $master_runid $offset</code>，主库就能通过 <code>$offset</code> 在 <code>repl_backlog_buffer</code> 中找到从库断开的位置，只发送 <code>$offset</code> 之后的增量给从库。</p>
<blockquote>
<p><code>repl_backlog_buffer</code>：为了解决从库断开后找到主从差异而设计的环形缓冲区。配置大一点，可以减少全量同步的频率。</p>
<p><code>replication buffer</code>：客户端、从库与 Redis 通信时，Redis 都会分配一个内存 buffer 用于交互，把数据写进去并通过 socket 发送到对端。当对端为从库时，该 buffer 只负责传播写命令，通常叫做 <code>replication buffer</code>。这个 buffer 由 <code>client-output-buffer-limit</code> 参数控制，如果过小或者从库处理过慢，Redis 会强制断开这个链接。</p>
</blockquote>
<h4 id="为啥不用-AOF-同步"><a href="#为啥不用-AOF-同步" class="headerlink" title="为啥不用 AOF 同步"></a>为啥不用 AOF 同步</h4><ol>
<li>相比 RDB 文件更大，效率低；</li>
<li>必须打开 AOF，数据丢失不敏感业务没必要开启</li>
</ol>
<hr>
<h2 id="7-哨兵"><a href="#7-哨兵" class="headerlink" title="7. 哨兵"></a>7. 哨兵</h2><hr>
<h2 id="8-哨兵集群"><a href="#8-哨兵集群" class="headerlink" title="8. 哨兵集群"></a>8. 哨兵集群</h2><hr>
<h2 id="9-切片集群"><a href="#9-切片集群" class="headerlink" title="9. 切片集群"></a>9. 切片集群</h2><hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/14/sorting-algorithm-in-rust-std/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/14/sorting-algorithm-in-rust-std/" class="post-title-link" itemprop="url">Rust 标准库中的排序算法[WIP]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-14 16:34:03" itemprop="dateCreated datePublished" datetime="2021-09-14T16:34:03+08:00">2021-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="TimSort"><a href="#TimSort" class="headerlink" title="TimSort"></a>TimSort</h2><hr>
<h2 id="Pattern-defeating-Quicksort（pdqsort）"><a href="#Pattern-defeating-Quicksort（pdqsort）" class="headerlink" title="Pattern-defeating Quicksort（pdqsort）"></a>Pattern-defeating Quicksort（pdqsort）</h2><hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/14/design-pattern-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/14/design-pattern-3/" class="post-title-link" itemprop="url">设计模式（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-14 14:10:37" itemprop="dateCreated datePublished" datetime="2021-09-14T14:10:37+08:00">2021-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="装饰器（Decorator）"><a href="#装饰器（Decorator）" class="headerlink" title="装饰器（Decorator）"></a>装饰器（Decorator）</h2><blockquote>
<p>Component：定义一个对象接口，可以给这些对象动态地添加职责。<br>ConcreteComponent：定义对象，可以给这个对象添加一些职责。<br>Decorator：维持一个指向 Component 对象的指针，并定义一个与 Component 接口一致的接口。<br>ConcreteDecorator：实际的装饰对象，向组件添加职责。  </p>
</blockquote>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoratorPattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Component component0 = <span class="keyword">new</span> ADecorator(<span class="keyword">new</span> BDecorator(<span class="keyword">new</span> Component0()));</span><br><span class="line">        component0.doSth();</span><br><span class="line">        System.out.println();</span><br><span class="line">        Component component1 = <span class="keyword">new</span> BDecorator(<span class="keyword">new</span> ADecorator(<span class="keyword">new</span> BDecorator(<span class="keyword">new</span> ADecorator(<span class="keyword">new</span> Component1()))));</span><br><span class="line">        component1.doSth();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Component0</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Component1</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> Component component;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.component = component;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ADecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ADecorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(component);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            component.doSth();</span><br><span class="line">            System.out.print(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BDecorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(component);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            component.doSth();</span><br><span class="line">            System.out.print(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Component</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">do_sth</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Component1</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> Component1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">do_sth</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Component2</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> Component2 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">do_sth</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Decorator</span></span>&lt;T: Component&gt;: Component &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">wrap</span></span>(inner: T) -&gt; <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DecoratorA</span></span>&lt;T&gt; &#123;</span><br><span class="line">    inner: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Component&gt; Component <span class="keyword">for</span> DecoratorA&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">do_sth</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.inner.do_sth();</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Component&gt; Decorator&lt;T&gt; <span class="keyword">for</span> DecoratorA&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">wrap</span></span>(inner: T) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; inner &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DecoratorB</span></span>&lt;T&gt; &#123;</span><br><span class="line">    inner: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Component&gt; Component <span class="keyword">for</span> DecoratorB&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">do_sth</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.inner.do_sth();</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Component&gt; Decorator&lt;T&gt; <span class="keyword">for</span> DecoratorB&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">wrap</span></span>(inner: T) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; inner &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_decorator</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> c1 = Component1;</span><br><span class="line">    c1.do_sth();</span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line">    <span class="keyword">let</span> ab1 = DecoratorA::wrap(DecoratorB::wrap(Component1));</span><br><span class="line">    ab1.do_sth();</span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line">    <span class="keyword">let</span> abbaa2 = DecoratorA::wrap(DecoratorB::wrap(DecoratorB::wrap(DecoratorA::wrap(</span><br><span class="line">        DecoratorA::wrap(Component2),</span><br><span class="line">    ))));</span><br><span class="line">    abbaa2.do_sth();</span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在Rust中，如果不需要运行时动态装饰，就没有必要产生很多小对象</span></span><br><span class="line">    <span class="comment">// 装饰了好几轮，最后占用内存还是 Component2 的大小</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        std::mem::size_of::&lt;</span><br><span class="line">            DecoratorA&lt;DecoratorB&lt;DecoratorB&lt;DecoratorA&lt;DecoratorA&lt;Component2&gt;&gt;&gt;&gt;&gt;,</span><br><span class="line">        &gt;(),</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1BA</span><br><span class="line">2AABBA</span><br></pre></td></tr></table></figure>
<blockquote>
<p>优点：比继承更灵活，避免类爆炸；可以组合；装饰器和构件可以独立变化，符合开闭原则。<br>缺点：产生很多小对象，增加系统复杂度和理解难度，调试困难。</p>
</blockquote>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/13/quick-sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/13/quick-sort/" class="post-title-link" itemprop="url">快速排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-13 15:34:56" itemprop="dateCreated datePublished" datetime="2021-09-13T15:34:56+08:00">2021-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="分区问题"><a href="#分区问题" class="headerlink" title="分区问题"></a>分区问题</h2><h3 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h3><p>将一个数组分为两个区域，小于等于N在左，大于N的在右；返回右侧的起始位置。</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> value, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || start &gt;= end) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> left = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array[i] &lt;= value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left == -<span class="number">1</span>) &#123;</span><br><span class="line">                left = start;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(array, i, left);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> left + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> partition(array, value, <span class="number">0</span>, array.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[2, 3, 5, 1, 2, 6, 4, 3, 8, 4, 3, 5, 1, 3, 5, 8]</span><br><span class="line">10</span><br><span class="line">[2, 3, 1, 2, 4, 3, 4, 3, 1, 3, 6, 5, 8, 5, 5, 8]</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_partition</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> array = [<span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.partition(<span class="number">5</span>), Index::Position(<span class="number">9</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.partition(<span class="number">3</span>), Index::Position(<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.partition(<span class="number">11</span>), Index::Greater);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.partition(<span class="number">0</span>), Index::Less);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Eq, PartialEq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">Index</span></span> &#123;</span><br><span class="line">    <span class="comment">// 值比所有数组元素都小</span></span><br><span class="line">    Less,</span><br><span class="line">    <span class="comment">// 能找到一个分区位置</span></span><br><span class="line">    Position(<span class="built_in">usize</span>),</span><br><span class="line">    <span class="comment">// 值比所有数组元素都大</span></span><br><span class="line">    Greater,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Partition</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; Index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span>&gt; Partition&lt;T&gt; <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="comment">// 返回大于部分的起始索引</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; Index &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> left = <span class="literal">None</span>;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.len() &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>[i] &lt;= value &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(left_val) = left &#123;</span><br><span class="line">                    <span class="keyword">let</span> new_left_val = left_val + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">self</span>.swap(i, new_left_val);</span><br><span class="line">                    left = <span class="literal">Some</span>(new_left_val);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">self</span>.swap(i, <span class="number">0</span>);</span><br><span class="line">                    left = <span class="literal">Some</span>(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> left &#123;</span><br><span class="line">            <span class="literal">None</span> =&gt; Index::Less,</span><br><span class="line">            <span class="literal">Some</span>(i) <span class="keyword">if</span> i == <span class="keyword">self</span>.len() - <span class="number">1</span> =&gt; Index::Greater,</span><br><span class="line">            <span class="literal">Some</span>(i) =&gt; Index::Position(i + <span class="number">1</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h3 id="荷兰-🇳🇱-国旗问题（三分）"><a href="#荷兰-🇳🇱-国旗问题（三分）" class="headerlink" title="荷兰 🇳🇱 国旗问题（三分）"></a>荷兰 🇳🇱 国旗问题（三分）</h3><p>将一个数组分为三个区域，小于N在左，等于N在中间，大于N的在右；返回中间和右侧的起始位置。</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    array[i] = array[i] ^ array[j];</span><br><span class="line">    array[j] = array[i] ^ array[j];</span><br><span class="line">    array[i] = array[i] ^ array[j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span>[] netherlandsFlagPartition(<span class="keyword">int</span>[] array, <span class="keyword">int</span> value) &#123;</span><br><span class="line">    <span class="keyword">return</span> netherlandsFlagPartition(array, value, <span class="number">0</span>, array.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span>[] netherlandsFlagPartition(<span class="keyword">int</span>[] array, <span class="keyword">int</span> value, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || start &gt;= end) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> left = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> right = end;</span><br><span class="line">    <span class="keyword">int</span> i = start;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i &lt; right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array[i] &lt; value) &#123;</span><br><span class="line">            left = left == -<span class="number">1</span> ? start : (left + <span class="number">1</span>);</span><br><span class="line">            swap(array, left, i);</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (array[i] &gt; value) &#123;</span><br><span class="line">            right -= <span class="number">1</span>;</span><br><span class="line">            swap(array, right, i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// array[i] == value</span></span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;left + <span class="number">1</span>, right&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10, 13]</span><br><span class="line">[2, 3, 1, 2, 4, 3, 4, 3, 1, 3, 5, 5, 5, 8, 6, 8]</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_netherlands_flag_partition</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> array = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>];</span><br><span class="line">    <span class="comment">// sorted:      [0, 0, 1, 1, 2, 2, 3, 4, 5, 5, 6, 7, 7, 8, 8, 9]</span></span><br><span class="line">    <span class="comment">// index(hex):  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, F]</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.netherlands_flag_partition(<span class="number">2</span>), (<span class="literal">Some</span>(<span class="number">4</span>), <span class="literal">Some</span>(<span class="number">6</span>)));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.netherlands_flag_partition(<span class="number">7</span>), (<span class="literal">Some</span>(<span class="number">0xB</span>), <span class="literal">Some</span>(<span class="number">0xD</span>)));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.netherlands_flag_partition(-<span class="number">1</span>), (<span class="literal">None</span>, <span class="literal">Some</span>(<span class="number">0</span>)));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(array.netherlands_flag_partition(<span class="number">0</span>), (<span class="literal">None</span>, <span class="literal">Some</span>(<span class="number">2</span>)));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">10</span>),</span><br><span class="line">        (<span class="literal">Some</span>(array.len()), <span class="literal">None</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">9</span>),</span><br><span class="line">        (<span class="literal">Some</span>(array.len() - <span class="number">1</span>), <span class="literal">None</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">NetherlandsFlagPartition</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">netherlands_flag_partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; (<span class="built_in">Option</span>&lt;<span class="built_in">usize</span>&gt;, <span class="built_in">Option</span>&lt;<span class="built_in">usize</span>&gt;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span>&gt; NetherlandsFlagPartition&lt;T&gt; <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="comment">// 返回相等部分和大于部分的起始索引</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">netherlands_flag_partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; (<span class="built_in">Option</span>&lt;<span class="built_in">usize</span>&gt;, <span class="built_in">Option</span>&lt;<span class="built_in">usize</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> left = <span class="literal">None</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> right = <span class="literal">None</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> i &lt; right.unwrap_or(len) &#123;</span><br><span class="line">            <span class="keyword">match</span> <span class="keyword">self</span>[i].cmp(&amp;value) &#123;</span><br><span class="line">                Ordering::Less =&gt; &#123;</span><br><span class="line">                    <span class="keyword">match</span> left &#123;</span><br><span class="line">                        <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                            <span class="keyword">self</span>.swap(<span class="number">0</span>, i);</span><br><span class="line">                            left = <span class="literal">Some</span>(<span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="literal">Some</span>(left_value) =&gt; &#123;</span><br><span class="line">                            <span class="keyword">let</span> new_left = left_value + <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">self</span>.swap(new_left, i);</span><br><span class="line">                            left = <span class="literal">Some</span>(new_left);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Ordering::Equal =&gt; &#123;</span><br><span class="line">                    i += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Ordering::Greater =&gt; &#123;</span><br><span class="line">                    <span class="keyword">match</span> right &#123;</span><br><span class="line">                        <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                            <span class="keyword">self</span>.swap(len - <span class="number">1</span>, i);</span><br><span class="line">                            right = <span class="literal">Some</span>(len - <span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="literal">Some</span>(right_value) =&gt; &#123;</span><br><span class="line">                            <span class="keyword">let</span> new_right = right_value - <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">self</span>.swap(new_right, i);</span><br><span class="line">                            right = <span class="literal">Some</span>(new_right);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// i 不要自增，让下一次循环检查新换到前面的值</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        (left.map(|v| v + <span class="number">1</span>), right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现（用枚举表示结果）</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp::Ordering;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_netherlands_flag_partition</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> array = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">2</span>),</span><br><span class="line">        NetherlandsFlagResult::Three(<span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">7</span>),</span><br><span class="line">        NetherlandsFlagResult::Three(<span class="number">11</span>, <span class="number">13</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(-<span class="number">1</span>),</span><br><span class="line">        NetherlandsFlagResult::Greater</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">0</span>),</span><br><span class="line">        NetherlandsFlagResult::ValueStart(<span class="number">2</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">10</span>),</span><br><span class="line">        NetherlandsFlagResult::Less</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">9</span>),</span><br><span class="line">        NetherlandsFlagResult::ValueEnd(<span class="number">15</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> array = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        array.netherlands_flag_partition(<span class="number">2</span>),</span><br><span class="line">        NetherlandsFlagResult::Equal</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Eq, PartialEq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">NetherlandsFlagResult</span></span> &#123;</span><br><span class="line">    <span class="comment">/// 分为三部分，分别是 &lt; value, == value, &gt; value, 返回后两部分的起始索引</span></span><br><span class="line">    Three(<span class="built_in">usize</span>, <span class="built_in">usize</span>),</span><br><span class="line">    <span class="comment">/// 分为两部分，== value, &gt; value, 返回第二部分的起始索引</span></span><br><span class="line">    ValueStart(<span class="built_in">usize</span>),</span><br><span class="line">    <span class="comment">/// 分为两部分，&lt; value, == value, 返回第二部分的起始索引</span></span><br><span class="line">    ValueEnd(<span class="built_in">usize</span>),</span><br><span class="line">    <span class="comment">/// 所有值都小于 value</span></span><br><span class="line">    Less,</span><br><span class="line">    <span class="comment">/// 所有值都大于 value</span></span><br><span class="line">    Greater,</span><br><span class="line">    <span class="comment">/// 所有值都等于 value</span></span><br><span class="line">    Equal,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">NetherlandsFlagPartition</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">netherlands_flag_partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; NetherlandsFlagResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span>&gt; NetherlandsFlagPartition&lt;T&gt; <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="comment">// 返回相等部分和大于部分的起始索引</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">netherlands_flag_partition</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) -&gt; NetherlandsFlagResult &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> left = <span class="literal">None</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> right = <span class="literal">None</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> i &lt; right.unwrap_or(len) &#123;</span><br><span class="line">            <span class="keyword">match</span> <span class="keyword">self</span>[i].cmp(&amp;value) &#123;</span><br><span class="line">                Ordering::Less =&gt; &#123;</span><br><span class="line">                    <span class="keyword">match</span> left &#123;</span><br><span class="line">                        <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                            <span class="keyword">self</span>.swap(<span class="number">0</span>, i);</span><br><span class="line">                            left = <span class="literal">Some</span>(<span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="literal">Some</span>(left_value) =&gt; &#123;</span><br><span class="line">                            <span class="keyword">let</span> new_left = left_value + <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">self</span>.swap(new_left, i);</span><br><span class="line">                            left = <span class="literal">Some</span>(new_left);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Ordering::Equal =&gt; &#123;</span><br><span class="line">                    i += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Ordering::Greater =&gt; &#123;</span><br><span class="line">                    <span class="keyword">match</span> right &#123;</span><br><span class="line">                        <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                            <span class="keyword">self</span>.swap(len - <span class="number">1</span>, i);</span><br><span class="line">                            right = <span class="literal">Some</span>(len - <span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="literal">Some</span>(right_value) =&gt; &#123;</span><br><span class="line">                            <span class="keyword">let</span> new_right = right_value - <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">self</span>.swap(new_right, i);</span><br><span class="line">                            right = <span class="literal">Some</span>(new_right);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// i 不要自增，让下一次循环检查新换到前面的值</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> (left.map(|v| v + <span class="number">1</span>), right) &#123;</span><br><span class="line">            (<span class="literal">None</span>, <span class="literal">Some</span>(i)) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">                    NetherlandsFlagResult::Greater</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    NetherlandsFlagResult::ValueStart(i)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            (<span class="literal">Some</span>(i), <span class="literal">None</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> i &gt;= <span class="keyword">self</span>.len() &#123;</span><br><span class="line">                    NetherlandsFlagResult::Less</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    NetherlandsFlagResult::ValueEnd(i)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            (<span class="literal">Some</span>(i), <span class="literal">Some</span>(j)) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> i &gt;= <span class="keyword">self</span>.len() &#123;</span><br><span class="line">                    NetherlandsFlagResult::Greater</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    NetherlandsFlagResult::Three(i, j)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            (<span class="literal">None</span>, <span class="literal">None</span>) =&gt; NetherlandsFlagResult::Equal,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><h3 id="v1-0"><a href="#v1-0" class="headerlink" title="v1.0"></a>v1.0</h3><p>步骤：</p>
<ol>
<li>选择数组最后一个元素 <code>X</code>，在 <code>0..array.length-1</code> 的范围上进行二分，小于等于 <code>X</code> 的在左，大于 <code>X</code> 的在右；</li>
<li>将 <code>X</code> 与右侧的第一个元素交换；</li>
<li>将 <code>X</code> 左侧与右侧的数组分别进行上述操作，进行递归，过程中 <code>X</code> 不需要再移动。</li>
</ol>
<p>时间复杂度：$O(N)$</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort1</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">    recurse1(array, <span class="number">0</span>, array.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recurse1</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || start &gt;= end - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pivot = array[end - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> idx = partition(array, pivot, start, end - <span class="number">1</span>);</span><br><span class="line">    swap(array, idx, end - <span class="number">1</span>);</span><br><span class="line">    recurse1(array, start, idx);</span><br><span class="line">    recurse1(array, idx + <span class="number">1</span>, end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_quick_sort1</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">1000</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">u8</span>; <span class="number">32</span>] = rand::random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line"></span><br><span class="line">        array0.sort();</span><br><span class="line">        array1.quick_sort1();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(array0, array1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">QuickSort1</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort1</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span>&gt; QuickSort1 <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort1</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line">        <span class="keyword">if</span> len &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">self</span>[len - <span class="number">1</span>].clone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>[..len - <span class="number">1</span>].partition(value) &#123;</span><br><span class="line">            <span class="comment">// value 比所有元素都小，把 value 挪到第一个位置，排序剩下的</span></span><br><span class="line">            Index::Less =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.swap(<span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">self</span>[<span class="number">1</span>..].quick_sort1();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 把 value 与第一个大于区的数交换</span></span><br><span class="line">            Index::Position(i) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.swap(i, len - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">self</span>[..i].quick_sort1();</span><br><span class="line">                <span class="keyword">self</span>[i + <span class="number">1</span>..].quick_sort1();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// value比所有元素都大，不动，排序前面所有的</span></span><br><span class="line">            Index::Greater =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[..len - <span class="number">1</span>].quick_sort1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="v2-0"><a href="#v2-0" class="headerlink" title="v2.0"></a>v2.0</h3><ol>
<li>选择数组一个元素 <code>X</code>，进行荷兰国旗三分，小于 <code>X</code> 的在左，等于 <code>X</code> 的在中间，大于 <code>X</code> 的在右；</li>
<li>将 <code>X</code> 左侧与右侧的数组分别进行上述操作，进行递归，过程中位于中间的所有 <code>X</code> 不需要再移动。</li>
</ol>
<p>时间复杂度：$O(N)$</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort2</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">    recurse2(array, <span class="number">0</span>, array.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recurse2</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || start &gt;= end - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pivot = array[end - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span>[] idxs = netherlandsFlagPartition(array, pivot, start, end);</span><br><span class="line">    <span class="keyword">if</span> (idxs == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    recurse2(array, start, idxs[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (idxs[<span class="number">1</span>] &lt; end - <span class="number">1</span>) &#123;</span><br><span class="line">        recurse2(array, idxs[<span class="number">1</span>], end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_quick_sort2</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">1000</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">i32</span>; <span class="number">32</span>] = random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line"></span><br><span class="line">        array0.sort();</span><br><span class="line">        array1.quick_sort2();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(array0, array1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">QuickSort2</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort2</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span>&gt; QuickSort2 <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort2</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.len() &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">self</span>[<span class="number">0</span>].clone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.netherlands_flag_partition(value) &#123;</span><br><span class="line">            NetherlandsFlagResult::Three(start, end) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[..start].quick_sort2();</span><br><span class="line">                <span class="keyword">self</span>[end..].quick_sort2();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::ValueStart(start) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[start..].quick_sort2();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::ValueEnd(end) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[..end].quick_sort2();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::Less | NetherlandsFlagResult::Greater =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.quick_sort2();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::Equal =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="v3-0"><a href="#v3-0" class="headerlink" title="v3.0"></a>v3.0</h3><p>将 v2.0 中选择数组元素改为随机选择，其他不变。</p>
<blockquote>
<ol>
<li>划分值越靠近中间，性能越好；越靠近两边性能越差；</li>
<li>随机算一个数进行划分的目的就是让好情况和坏情况都变成概率事件；</li>
<li>把每一种情况都列出来，会有每种情况下的复杂度，但概率都是 $1/N$；</li>
<li>所有情况都考虑，则时间复杂度就是这种概率模型下的长期期望。</li>
</ol>
</blockquote>
<p>时间复杂度：$O(N \times logN)$<br>额外空间复杂度：$O(N \times logN)$</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort3</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">    recurse3(array, <span class="number">0</span>, array.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recurse3</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || start &gt;= end - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pi = (<span class="keyword">int</span>) (Math.random() * (end - start));</span><br><span class="line">    System.out.println(start + pi);</span><br><span class="line">    <span class="keyword">int</span> pivot = array[start + pi];</span><br><span class="line">    <span class="keyword">int</span>[] idxs = netherlandsFlagPartition(array, pivot, start, end);</span><br><span class="line">    <span class="keyword">if</span> (idxs == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    recurse3(array, start, idxs[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (idxs[<span class="number">1</span>] &lt; end - <span class="number">1</span>) &#123;</span><br><span class="line">        recurse3(array, idxs[<span class="number">1</span>], end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_quick_sort3</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">1000</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">i32</span>; <span class="number">32</span>] = random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line"></span><br><span class="line">        array0.sort();</span><br><span class="line">        array1.quick_sort3();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(array0, array1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">QuickSort3</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort3</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span>&gt; QuickSort <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">quick_sort3</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.len() &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> index = rand::thread_rng().gen_range(<span class="number">0</span>..<span class="keyword">self</span>.len());</span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">self</span>[index].clone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.netherlands_flag_partition(value) &#123;</span><br><span class="line">            NetherlandsFlagResult::Three(start, end) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[..start].quick_sort3();</span><br><span class="line">                <span class="keyword">self</span>[end..].quick_sort3();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::ValueStart(start) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[start..].quick_sort3();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::ValueEnd(end) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>[..end].quick_sort3();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::Less | NetherlandsFlagResult::Greater =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.quick_sort3();</span><br><span class="line">            &#125;</span><br><span class="line">            NetherlandsFlagResult::Equal =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Swap-函数"><a href="#Swap-函数" class="headerlink" title="Swap 函数"></a>Swap 函数</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    array[i] = array[i] ^ array[j];</span><br><span class="line">    array[j] = array[i] ^ array[j];</span><br><span class="line">    array[i] = array[i] ^ array[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/11/merge-sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/11/merge-sort/" class="post-title-link" itemprop="url">归并排序及应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-12 00:05:51" itemprop="dateCreated datePublished" datetime="2021-09-12T00:05:51+08:00">2021-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><ul>
<li>算法时间复杂度： $O(NlogN)$</li>
<li>相比冒泡、选择等时间复杂度为 $O(N^2)$ 的排序算法，没有浪费比较行为；</li>
<li>插入排序时即便使用二分查找插入位置，也需要将插入位置后的元素依次向右移动，每次插入复杂度不是 $O(1)$。</li>
</ul>
<h3 id="递归方法"><a href="#递归方法" class="headerlink" title="递归方法"></a>递归方法</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer[] data = &#123;<span class="number">12</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(data));</span><br><span class="line">        mergeSort(data);</span><br><span class="line">        System.out.println(Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T extends Comparable&gt; <span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        T[] help = (T[]) <span class="keyword">new</span> Comparable[array.length];</span><br><span class="line">        doMergeSort(array, help, <span class="number">0</span>, array.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T extends Comparable&gt; <span class="function"><span class="keyword">void</span> <span class="title">doMergeSort</span><span class="params">(T[] array, T[] help, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (start == end - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mid = start + ((end - start) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        doMergeSort(array, help, start, mid);</span><br><span class="line">        doMergeSort(array, help, mid, end);</span><br><span class="line">        mergeSorted(array, help, start, mid, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T extends Comparable&gt; <span class="function"><span class="keyword">void</span> <span class="title">mergeSorted</span><span class="params">(T[] array, T[] help, <span class="keyword">int</span> start, <span class="keyword">int</span> mid, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = start;</span><br><span class="line">        <span class="keyword">int</span> i = start;</span><br><span class="line">        <span class="keyword">int</span> j = mid;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; mid &amp;&amp; j &lt; end) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array[i].compareTo(array[j]) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                help[h++] = array[i++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                help[h++] = array[j++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; mid) &#123;</span><br><span class="line">            help[h++] = array[i++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &lt; end) &#123;</span><br><span class="line">            help[h++] = array[j++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> h == end;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n = start; n &lt; end; n++) &#123;</span><br><span class="line">            array[n] = help[n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[12, 3, 2, 6, 4, 8, 6, 0, 9, 3]</span><br><span class="line">[0, 2, 3, 3, 4, 6, 6, 8, 9, 12]</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_merge_sort</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">100</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">u8</span>; <span class="number">32</span>] = rand::random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line">        array0.merge_sort();</span><br><span class="line">        array1.sort();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(array0, array1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">MergeSort</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">merge_sort</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span>&gt; MergeSort <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">merge_sort</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line">        <span class="keyword">if</span> len == <span class="number">0</span> || len == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> mid = len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">self</span>[..mid].merge_sort();</span><br><span class="line">        <span class="keyword">self</span>[mid..].merge_sort();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> j = mid;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> vec = <span class="built_in">Vec</span>::with_capacity(len);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i &lt; mid &amp;&amp; j &lt; len &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>[i] &lt;= <span class="keyword">self</span>[j] &#123;</span><br><span class="line">                vec.push(<span class="keyword">self</span>[i].clone());</span><br><span class="line">                i += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                vec.push(<span class="keyword">self</span>[j].clone());</span><br><span class="line">                j += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i &lt; mid &#123;</span><br><span class="line">            vec.push(<span class="keyword">self</span>[i].clone());</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> j &lt; len &#123;</span><br><span class="line">            vec.push(<span class="keyword">self</span>[j].clone());</span><br><span class="line">            j += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.clone_from_slice(&amp;vec);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="非递归方法"><a href="#非递归方法" class="headerlink" title="非递归方法"></a>非递归方法</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">mergeSortLoop</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Comparable[] help = (T[]) <span class="keyword">new</span> Comparable[array.length];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> mergeSize = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (mergeSize &lt; array.length) &#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt; array.length) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = left + mergeSize;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mid &gt;= array.length) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> right = Math.min(mid + mergeSize, array.length);</span><br><span class="line">            mergeSorted(array, help, left, mid, right);</span><br><span class="line">            left = right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mergeSize &gt;= array.length &gt;&gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mergeSize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Rust 实现</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_loop_merge_sort</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">100</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">u8</span>; <span class="number">32</span>] = rand::random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line">        array0.loop_merge_sort();</span><br><span class="line">        array1.sort();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(array0, array1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span>&gt; MergeSort <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">merge_sort</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">loop_merge_sort</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line">        <span class="keyword">if</span> len &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> merge_size: <span class="built_in">usize</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> merge_size &lt; len &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> left = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> left &lt; len &#123;</span><br><span class="line">                <span class="keyword">let</span> mid = left + merge_size;</span><br><span class="line">                <span class="keyword">if</span> mid &gt;= len &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> right = (mid + merge_size).min(len);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// merge sorted</span></span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">mut</span> vec = <span class="built_in">Vec</span>::with_capacity(right - left);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">mut</span> i = left;</span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">mut</span> j = mid;</span><br><span class="line">                <span class="keyword">while</span> i &lt; mid &amp;&amp; j &lt; right &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">self</span>[i] &lt;= <span class="keyword">self</span>[j] &#123;</span><br><span class="line">                        vec.push(<span class="keyword">self</span>[i].clone());</span><br><span class="line">                        i += <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        vec.push(<span class="keyword">self</span>[j].clone());</span><br><span class="line">                        j += <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> i &lt; mid &#123;</span><br><span class="line">                    vec.push(<span class="keyword">self</span>[i].clone());</span><br><span class="line">                    i += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> j &lt; right &#123;</span><br><span class="line">                    vec.push(<span class="keyword">self</span>[j].clone());</span><br><span class="line">                    j += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                (&amp;<span class="keyword">mut</span> <span class="keyword">self</span>[left..right]).clone_from_slice(&amp;vec);</span><br><span class="line"></span><br><span class="line">                left = right;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> merge_size &gt; len &gt;&gt; <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            merge_size &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h2 id="求数组的小和"><a href="#求数组的小和" class="headerlink" title="求数组的小和"></a>求数组的小和</h2><p>在一个数组中，一个数左边比它小的数的总和，叫数的小和，所有数的小和加起来叫数组小和。求数组小和。</p>
<blockquote>
<p>例子：<code>[1, 3, 4, 2, 5]</code></p>
<p><code>1</code> 左边比自己小的数：没有<br><code>3</code> 左边比自己小的数：<code>1</code><br><code>4</code> 左边比自己小的数：<code>1</code> <code>3</code><br><code>2</code> 左边比自己小的数：<code>1</code><br><code>5</code> 左边比自己小的数：<code>1</code> <code>3</code> <code>4</code> <code>2</code>  </p>
<p>所以，数组的小和为 $1 + 1 + 3 + 1 + 1 + 3 + 4 + 2 = 16$</p>
</blockquote>
<ul>
<li>Java 实现</li>
</ul>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmallSum</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(smallSum(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>&#125;) + <span class="string">&quot; == &quot;</span> + getSmallSumSimple(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>&#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSmallSumSimple</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> smallSum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[j] &lt; array[i]) &#123;</span><br><span class="line">                    smallSum += array[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> smallSum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">smallSum</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] help = <span class="keyword">new</span> <span class="keyword">int</span>[array.length];</span><br><span class="line">        <span class="keyword">return</span> doMergeSmallSum(array, help, <span class="number">0</span>, help.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">doMergeSmallSum</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span>[] help, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (end - start &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mid = start + ((end - start) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> left = doMergeSmallSum(array, help, start, mid);</span><br><span class="line">        <span class="keyword">int</span> right = doMergeSmallSum(array, help, mid, end);</span><br><span class="line">        <span class="keyword">return</span> left + right + doMerge(array, help, start, mid, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">doMerge</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span>[] help, <span class="keyword">int</span> start, <span class="keyword">int</span> mid, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = start;</span><br><span class="line">        <span class="keyword">int</span> j = mid;</span><br><span class="line">        <span class="keyword">int</span> k = start;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; mid &amp;&amp; j &lt; end) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array[i] &lt; array[j]) &#123;</span><br><span class="line">                <span class="keyword">int</span> t = array[i++];</span><br><span class="line">                help[k++] = t;</span><br><span class="line">                sum += t * (end - j);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                help[k++] = array[j++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; mid) &#123;</span><br><span class="line">            help[k++] = array[i++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &lt; end) &#123;</span><br><span class="line">            help[k++] = array[j++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (k = start; k &lt; end; k++) &#123;</span><br><span class="line">            array[k] = help[k];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h2 id="求数组中的降序对"><a href="#求数组中的降序对" class="headerlink" title="求数组中的降序对"></a>求数组中的降序对</h2><blockquote>
<p>例如：<code>[3, 1, 7, 0, 2]</code> 中的降序对有 <code>(3, 1)</code>、<code>(3, 0)</code>、<code>(3, 2)</code>、<code>(1, 0)</code>、<code>(7, 0)</code>、<code>(7, 2)</code>。</p>
</blockquote>
<p>即求数组中每个数右边有多少个数比它小，就有多少个降序对。</p>
<ul>
<li>Rust 实现</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_get_descending_pairs</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">100</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array0: [<span class="built_in">u8</span>; <span class="number">32</span>] = rand::random();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> array1 = array0.clone();</span><br><span class="line">        <span class="keyword">let</span> set0 = array0.get_descending_pairs();</span><br><span class="line">        <span class="keyword">let</span> set1 = array1.get_descending_pairs_simple();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(set0, set1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">DescendingPair</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">get_descending_pairs</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; HashSet&lt;(T, T)&gt;;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">get_descending_pairs_simple</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; HashSet&lt;(T, T)&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Ord</span> + <span class="built_in">Clone</span> + Hash&gt; DescendingPair&lt;T&gt; <span class="keyword">for</span> [T] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">get_descending_pairs</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; HashSet&lt;(T, T)&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> set = HashSet::new();</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.len() &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> set;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> mid = <span class="keyword">self</span>.len() &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> left = <span class="keyword">self</span>[..mid].get_descending_pairs();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> right = <span class="keyword">self</span>[mid..].get_descending_pairs();</span><br><span class="line">        set.extend(left.drain());</span><br><span class="line">        set.extend(right.drain());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> help = <span class="built_in">Vec</span>::with_capacity(<span class="keyword">self</span>.len());</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> k = mid;</span><br><span class="line">        <span class="keyword">let</span> len = <span class="keyword">self</span>.len();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> j &lt; mid &amp;&amp; k &lt; len &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>[j] &gt; <span class="keyword">self</span>[k] &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">mut</span> temp = <span class="keyword">self</span>[k..]</span><br><span class="line">                    .iter()</span><br><span class="line">                    .map(|v| (<span class="keyword">self</span>[j].clone(), v.clone()))</span><br><span class="line">                    .collect::&lt;HashSet&lt;_&gt;&gt;();</span><br><span class="line">                set.extend(temp.drain());</span><br><span class="line"></span><br><span class="line">                help.push(<span class="keyword">self</span>[j].clone());</span><br><span class="line">                j += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                help.push(<span class="keyword">self</span>[k].clone());</span><br><span class="line">                k += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        help.extend_from_slice(&amp;<span class="keyword">self</span>[j..mid]);</span><br><span class="line">        help.extend_from_slice(&amp;<span class="keyword">self</span>[k..]);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(help.len(), <span class="keyword">self</span>.len());</span><br><span class="line">        <span class="keyword">self</span>.clone_from_slice(&amp;help);</span><br><span class="line"></span><br><span class="line">        set</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">get_descending_pairs_simple</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; HashSet&lt;(T, T)&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> set = HashSet::new();</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.len() &#123;</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">0</span>..i &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>[j] &gt; <span class="keyword">self</span>[i] &#123;</span><br><span class="line">                    set.insert((<span class="keyword">self</span>[j].clone(), <span class="keyword">self</span>[i].clone()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        set</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/06/recursive-time-complexity-formula/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/06/recursive-time-complexity-formula/" class="post-title-link" itemprop="url">递归算法时间复杂度公式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-06 16:39:50" itemprop="dateCreated datePublished" datetime="2021-09-06T16:39:50+08:00">2021-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>当递归函数的时间执行函数满足如下的关系式时，可以使用公式法计算时间复杂度：</p>
<script type="math/tex; mode=display">
T(N) = a \cdot T(\frac {N} {b}) + O(N^d)</script><blockquote>
<p>其中：  </p>
<ol>
<li>$a$ 为递归次数；  </li>
<li>$\frac {N} {b}$ 为子问题规模；    </li>
<li>$O(N^d)$ 为每次递归完毕之后额外执行的操作的时间复杂度；  </li>
</ol>
</blockquote>
<ul>
<li>如果 $\log_b a &lt; d$，时间复杂度为 $O(N^d)$</li>
<li>如果 $\log_b a &gt; d$，时间复杂度为 $O(N^{\log_b a})$</li>
<li>如果 $\log_b a = d$，时间复杂度为 $O(N^d \times \log N)$</li>
</ul>
<hr>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>求数组 arr[l..r]中的最大值，用递归方法实现。</p>
<ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecursiveMax</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer[] array = &#123;<span class="number">6</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">7</span>&#125;;</span><br><span class="line">        System.out.println(getMax(array, <span class="number">0</span>, array.length - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;T&gt;&gt; <span class="function">T <span class="title">getMax</span><span class="params">(T[] arr, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            <span class="keyword">return</span> arr[l];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mid = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        T left = getMax(arr, l, mid);</span><br><span class="line">        T right = getMax(arr, mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="keyword">return</span> left.compareTo(right) &gt;= <span class="number">0</span> ? left : right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中：  </p>
<ol>
<li>递归次数 $a$ 为 $2$；  </li>
<li>子问题规模 $\frac {N} {b}$ 为 $\frac {N} {2}$，即 $b$ 为 $2$；    </li>
<li>每次递归完毕之后额外执行的操作的时间复杂度 $O(N^d)$ 为 $O(1)$，即 $d$ 为 $0$。 </li>
</ol>
<p>满足：  </p>
<script type="math/tex; mode=display">
\log_b a = log_2 2 = 1 > d = 0</script><p>所以，该算法复杂度为 $O(N^{\log_2 2}) = O(N)$</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gteng.org/2021/09/06/stack-and-queue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Thomasg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一口笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/06/stack-and-queue/" class="post-title-link" itemprop="url">栈和队列</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-06 15:45:08" itemprop="dateCreated datePublished" datetime="2021-09-06T15:45:08+08:00">2021-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-24 16:48:32" itemprop="dateModified" datetime="2025-01-24T16:48:32+08:00">2025-01-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-环形队列"><a href="#1-环形队列" class="headerlink" title="1. 环形队列"></a>1. 环形队列</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RingBuffer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 队列缓冲区</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] array;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 队列尺寸</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表示即将入队的索引位置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pushIndex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表示即将出队的索引位置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> popIndex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表示当前队列中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RingBuffer</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (limit &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;limit should be greater than 0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.limit = limit;</span><br><span class="line">        <span class="keyword">this</span>.array = <span class="keyword">new</span> Object[limit];</span><br><span class="line">        <span class="keyword">this</span>.popIndex = <span class="keyword">this</span>.pushIndex = <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">RingBuffer&lt;T&gt; <span class="title">create</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RingBuffer&lt;&gt;(limit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;T&gt; <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T value = (T) <span class="keyword">this</span>.array[<span class="keyword">this</span>.popIndex];</span><br><span class="line">        <span class="keyword">this</span>.array[<span class="keyword">this</span>.popIndex] = <span class="keyword">null</span>; <span class="comment">// 去掉引用，避免泄漏</span></span><br><span class="line">        <span class="keyword">this</span>.size -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.popIndex = getNextIndex(<span class="keyword">this</span>.popIndex);</span><br><span class="line">        <span class="keyword">return</span> Optional.of(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="keyword">this</span>.limit) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;The size has reached the limit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.array[<span class="keyword">this</span>.pushIndex] = value;</span><br><span class="line">        <span class="keyword">this</span>.size += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.pushIndex = getNextIndex(<span class="keyword">this</span>.pushIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RingBuffer&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;array=&quot;</span> + Arrays.toString(array) +</span><br><span class="line">                <span class="string">&quot;, limit=&quot;</span> + limit +</span><br><span class="line">                <span class="string">&quot;, pushIndex=&quot;</span> + pushIndex +</span><br><span class="line">                <span class="string">&quot;, popIndex=&quot;</span> + popIndex +</span><br><span class="line">                <span class="string">&quot;, size=&quot;</span> + size +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getNextIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index == <span class="keyword">this</span>.limit - <span class="number">1</span> ? <span class="number">0</span> : index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RingBuffer&lt;String&gt; rb = RingBuffer.create(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;new rb: &quot;</span> + rb);</span><br><span class="line">        String[] data = &#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;are&quot;</span>, <span class="string">&quot;you&quot;</span>, <span class="string">&quot;ok&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String s: data) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rb.push(s);</span><br><span class="line">                System.out.println(<span class="string">&quot;push &quot;</span> + s);</span><br><span class="line">                System.out.println(<span class="string">&quot;rb: &quot;</span> + rb);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Push &#x27;&quot;</span> + s + <span class="string">&quot;&#x27; error: &quot;</span> + e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Optional&lt;String&gt; op = rb.pop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (op.isPresent()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;pop &quot;</span> + op.get());</span><br><span class="line">            System.out.println(<span class="string">&quot;rb: &quot;</span> + rb);</span><br><span class="line">            op = rb.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">new rb: RingBuffer&#123;array&#x3D;[null, null, null, null], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;0, size&#x3D;0&#125;</span><br><span class="line">push hello</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[hello, null, null, null], limit&#x3D;4, pushIndex&#x3D;1, popIndex&#x3D;0, size&#x3D;1&#125;</span><br><span class="line">push world</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[hello, world, null, null], limit&#x3D;4, pushIndex&#x3D;2, popIndex&#x3D;0, size&#x3D;2&#125;</span><br><span class="line">push are</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[hello, world, are, null], limit&#x3D;4, pushIndex&#x3D;3, popIndex&#x3D;0, size&#x3D;3&#125;</span><br><span class="line">push you</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[hello, world, are, you], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;0, size&#x3D;4&#125;</span><br><span class="line">Push &#39;ok&#39; error: java.lang.IllegalArgumentException: The size has reached the limit</span><br><span class="line">pop hello</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[null, world, are, you], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;1, size&#x3D;3&#125;</span><br><span class="line">pop world</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[null, null, are, you], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;2, size&#x3D;2&#125;</span><br><span class="line">pop are</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[null, null, null, you], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;3, size&#x3D;1&#125;</span><br><span class="line">pop you</span><br><span class="line">rb: RingBuffer&#123;array&#x3D;[null, null, null, null], limit&#x3D;4, pushIndex&#x3D;0, popIndex&#x3D;0, size&#x3D;0&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-时间复杂度为-O-1-的栈中最小值获取方法"><a href="#2-时间复杂度为-O-1-的栈中最小值获取方法" class="headerlink" title="2. 时间复杂度为 $O(1)$ 的栈中最小值获取方法"></a>2. 时间复杂度为 $O(1)$ 的栈中最小值获取方法</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetMinStack</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stack&lt;E&gt; minStack;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GetMinStack&lt;Integer&gt; stack = <span class="keyword">new</span> GetMinStack&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span>[] data = &#123;<span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">9</span>, -<span class="number">1</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i: data) &#123;</span><br><span class="line">            stack.push(i);</span><br><span class="line">            Optional&lt;Integer&gt; min = stack.getMin();</span><br><span class="line">            System.out.println(<span class="string">&quot;push &quot;</span> + i + <span class="string">&quot;, min: &quot;</span> + min.get() + <span class="string">&quot;, stack&quot;</span> + stack + <span class="string">&quot;, minStack: &quot;</span> + stack.getMinStack());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.empty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> i = stack.pop();</span><br><span class="line">            Optional&lt;Integer&gt; min = stack.getMin();</span><br><span class="line">            <span class="keyword">if</span> (min.isPresent()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;pop &quot;</span> + i + <span class="string">&quot;, min: &quot;</span> + min.get() + <span class="string">&quot;, stack&quot;</span> + stack + <span class="string">&quot;, minStack: &quot;</span> + stack.getMinStack());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;pop &quot;</span> + i + <span class="string">&quot;, stack is empty&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetMinStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        minStack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E item = <span class="keyword">super</span>.pop();</span><br><span class="line">        E min = minStack.peek();</span><br><span class="line">        <span class="comment">// 如果出栈的元素跟最小栈顶元素相等，则最小栈顶也出栈</span></span><br><span class="line">        <span class="keyword">if</span> (min == item) &#123;</span><br><span class="line">            minStack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">push</span><span class="params">(E item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!minStack.empty()) &#123;</span><br><span class="line">            E min = minStack.peek();</span><br><span class="line">            <span class="comment">// 如果栈不空，看最小栈顶与入栈元素哪个小；</span></span><br><span class="line">            <span class="comment">// 一样大或者入栈元素小，则该元素入最小栈；</span></span><br><span class="line">            <span class="comment">// 否则不做任何操作</span></span><br><span class="line">            <span class="keyword">if</span> (min.compareTo(item) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                minStack.push(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 栈空就直接入栈</span></span><br><span class="line">            minStack.push(item);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.push(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;E&gt; <span class="title">getMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (empty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.of(minStack.peek());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;E&gt; <span class="title">getMinStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableCollection(<span class="keyword">this</span>.minStack);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">push 8, min: 8, stack[8], minStack: [8]</span><br><span class="line">push 4, min: 4, stack[8, 4], minStack: [8, 4]</span><br><span class="line">push 2, min: 2, stack[8, 4, 2], minStack: [8, 4, 2]</span><br><span class="line">push 6, min: 2, stack[8, 4, 2, 6], minStack: [8, 4, 2]</span><br><span class="line">push 1, min: 1, stack[8, 4, 2, 6, 1], minStack: [8, 4, 2, 1]</span><br><span class="line">push 9, min: 1, stack[8, 4, 2, 6, 1, 9], minStack: [8, 4, 2, 1]</span><br><span class="line">push -1, min: -1, stack[8, 4, 2, 6, 1, 9, -1], minStack: [8, 4, 2, 1, -1]</span><br><span class="line">push 3, min: -1, stack[8, 4, 2, 6, 1, 9, -1, 3], minStack: [8, 4, 2, 1, -1]</span><br><span class="line">pop 3, min: -1, stack[8, 4, 2, 6, 1, 9, -1], minStack: [8, 4, 2, 1, -1]</span><br><span class="line">pop -1, min: 1, stack[8, 4, 2, 6, 1, 9], minStack: [8, 4, 2, 1]</span><br><span class="line">pop 9, min: 1, stack[8, 4, 2, 6, 1], minStack: [8, 4, 2, 1]</span><br><span class="line">pop 1, min: 2, stack[8, 4, 2, 6], minStack: [8, 4, 2]</span><br><span class="line">pop 6, min: 2, stack[8, 4, 2], minStack: [8, 4, 2]</span><br><span class="line">pop 2, min: 4, stack[8, 4], minStack: [8, 4]</span><br><span class="line">pop 4, min: 8, stack[8], minStack: [8]</span><br><span class="line">pop 8, stack is empty</span><br></pre></td></tr></table></figure>
<h3 id="3-用栈实现队列"><a href="#3-用栈实现队列" class="headerlink" title="3. 用栈实现队列"></a>3. 用栈实现队列</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackQueue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 用来入队</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stack&lt;E&gt; pushStack;</span><br><span class="line">    <span class="comment">// 用来出队</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stack&lt;E&gt; popStack;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StackQueue&lt;String&gt; queue = <span class="keyword">new</span> StackQueue&lt;&gt;();</span><br><span class="line">        String[] data = &#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;how&quot;</span>, <span class="string">&quot;are&quot;</span>, <span class="string">&quot;you&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String s: data) &#123;</span><br><span class="line">            queue.push(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(queue);</span><br><span class="line">        Optional&lt;String&gt; op = queue.poll();</span><br><span class="line">        <span class="keyword">while</span> (op.isPresent()) &#123;</span><br><span class="line">            System.out.println(op.get());</span><br><span class="line">            op = queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(queue);</span><br><span class="line">        <span class="keyword">for</span> (String s: data) &#123;</span><br><span class="line">            queue.push(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(queue);</span><br><span class="line">        op = queue.poll();</span><br><span class="line">        <span class="keyword">for</span> (String s: data) &#123;</span><br><span class="line">            queue.push(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(queue);</span><br><span class="line">        <span class="keyword">while</span> (op.isPresent()) &#123;</span><br><span class="line">            System.out.println(op.get());</span><br><span class="line">            op = queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(queue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StackQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pushStack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        popStack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pushStack.size() + popStack.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pushStack.empty() &amp;&amp; popStack.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pushStack.contains(o) || popStack.contains(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E element)</span> </span>&#123;</span><br><span class="line">        pushStack.push(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;E&gt; <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (popStack.empty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!pushStack.empty()) &#123;</span><br><span class="line">                popStack.push(pushStack.pop());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (popStack.empty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> Optional.empty();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Optional.of(popStack.pop());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// =&gt; 表示栈顶</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;StackQueue&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;pushStack=&quot;</span> + pushStack +</span><br><span class="line">                <span class="string">&quot;=&gt;, popStack=&quot;</span> + popStack +</span><br><span class="line">                <span class="string">&quot;=&gt;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">StackQueue&#123;pushStack&#x3D;[hello, world, how, are, you]&#x3D;&gt;, popStack&#x3D;[]&#x3D;&gt;&#125;</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">how</span><br><span class="line">are</span><br><span class="line">you</span><br><span class="line">StackQueue&#123;pushStack&#x3D;[]&#x3D;&gt;, popStack&#x3D;[]&#x3D;&gt;&#125;</span><br><span class="line">StackQueue&#123;pushStack&#x3D;[hello, world, how, are, you]&#x3D;&gt;, popStack&#x3D;[]&#x3D;&gt;&#125;</span><br><span class="line">StackQueue&#123;pushStack&#x3D;[hello, world, how, are, you]&#x3D;&gt;, popStack&#x3D;[you, are, how, world]&#x3D;&gt;&#125;</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">how</span><br><span class="line">are</span><br><span class="line">you</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">how</span><br><span class="line">are</span><br><span class="line">you</span><br><span class="line">StackQueue&#123;pushStack&#x3D;[]&#x3D;&gt;, popStack&#x3D;[]&#x3D;&gt;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-用队列实现栈"><a href="#4-用队列实现栈" class="headerlink" title="4. 用队列实现栈"></a>4. 用队列实现栈</h3><ul>
<li>Java 实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueStack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;E&gt; data;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;E&gt; help;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        QueueStack&lt;String&gt; stack = <span class="keyword">new</span> QueueStack&lt;&gt;();</span><br><span class="line">        String[] data = &#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;how&quot;</span>, <span class="string">&quot;are&quot;</span>, <span class="string">&quot;you&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String s: data) &#123;</span><br><span class="line">            stack.push(s);</span><br><span class="line">        &#125;</span><br><span class="line">        Optional&lt;String&gt; op = stack.pop();</span><br><span class="line">        <span class="keyword">while</span> (op.isPresent()) &#123;</span><br><span class="line">            System.out.println(op.get());</span><br><span class="line">            op = stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QueueStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        help = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.isEmpty() &amp;&amp; help.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.contains(object) || help.contains(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.size() + help.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        data.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;E&gt; <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = data.size();</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size-<span class="number">1</span>;++i) &#123;</span><br><span class="line">            help.add(data.poll());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        E e = data.poll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// swap</span></span><br><span class="line">        Queue&lt;E&gt; temp = help;</span><br><span class="line">        help = data;</span><br><span class="line">        data = temp;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Optional.of(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">you</span><br><span class="line">are</span><br><span class="line">how</span><br><span class="line">world</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Thomasg</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gengteng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gengteng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:me@gteng.org" title="E-Mail → mailto:me@gteng.org"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Thomasg</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
